<!doctype html>
<html>
    <head>
                <title>Simulai models deeponet - SimulAI's Documentation</title>

            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">

            
            
            

            
                <link  rel="icon" type="image/x-icon" href="../../assets/img/favicon.ico">
            
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
                        <script>hljs.initHighlightingOnLoad();</script>
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
            <link rel="stylesheet" href="../../assets/css/main.min.css">
                <link href="../../assets/_mkdocstrings.css" rel="stylesheet">
                <script src="../../search/main.js"></script>

            
                
            
    </head>

    <body>
        <div class="container py-3">
            <header>
                    <!-- block header -->
<nav class="navbar navbar-expand-xl border-bottom">
    <div class="container-fluid">
        

        
            <span class="normal fs-4 title-color site-name" id="component-site-name" style="text-transform: uppercase;">SimulAI's Documentation</span>
        

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMenu"
            aria-controls="navbarsMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse flex-column ml-auto" id="navbarsMenu">
            <ul class="navbar-nav">

                <!-- block menu -->
                <li class="nav-item">
                    <!-- block menu -->
    
        <li class="nav-item" id="component-menu">
            <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="
                            nav-link text-gray text-decoration-none" href="../..">[Home]</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="
                            nav-link dropdown-toggle text-decoration-none" href="#" data-bs-toggle="dropdown">[Modules]</a>
                            <ul class="dropdown-menu">
                                    <!-- block dropdown-menu -->
    <li>
        <a class="dropdown-item text-decoration-none" href="#">IO &raquo;</a>
        <ul class="submenu dropdown-menu">
                <!-- block dropdown-menu -->
    <li>
        <a href="../../simulai_io/" class="dropdown-item text-decoration-none ">Simulai io</a>
    </li>
<!-- endblock -->
        </ul>
    </li>
<!-- endblock -->
                                    <!-- block dropdown-menu -->
    <li>
        <a class="dropdown-item text-decoration-none" href="#">Symbolic Manipulation &raquo;</a>
        <ul class="submenu dropdown-menu">
                <!-- block dropdown-menu -->
    <li>
        <a href="../../simulai_residuals/" class="dropdown-item text-decoration-none ">Simulai residuals</a>
    </li>
<!-- endblock -->
        </ul>
    </li>
<!-- endblock -->
                                    <!-- block dropdown-menu -->
    <li>
        <a class="dropdown-item text-decoration-none" href="#">Regression/Neural Networks &raquo;</a>
        <ul class="submenu dropdown-menu">
                <!-- block dropdown-menu -->
    <li>
        <a href="../../simulai_regression/" class="dropdown-item text-decoration-none ">Simulai regression</a>
    </li>
<!-- endblock -->
        </ul>
    </li>
<!-- endblock -->
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class=" active 
                            nav-link dropdown-toggle text-decoration-none" href="#" data-bs-toggle="dropdown">[Subpackages]</a>
                            <ul class="dropdown-menu">
                                    <!-- block dropdown-menu -->
    <li>
        <a class="dropdown-item text-decoration-none" href="#">Models &raquo;</a>
        <ul class="submenu dropdown-menu">
                <!-- block dropdown-menu -->
    <li>
        <a class="dropdown-item text-decoration-none" href="#">Transformer &raquo;</a>
        <ul class="submenu dropdown-menu">
                <!-- block dropdown-menu -->
    <li>
        <a href="../simulai_models_transformer/" class="dropdown-item text-decoration-none ">Simulai models transformer</a>
    </li>
<!-- endblock -->
        </ul>
    </li>
<!-- endblock -->
                <!-- block dropdown-menu -->
    <li>
        <a class="dropdown-item text-decoration-none" href="#">DeepONet &raquo;</a>
        <ul class="submenu dropdown-menu">
                <!-- block dropdown-menu -->
    <li>
        <a href="./" class="dropdown-item text-decoration-none  active ">Simulai models deeponet</a>
    </li>
<!-- endblock -->
        </ul>
    </li>
<!-- endblock -->
                <!-- block dropdown-menu -->
    <li>
        <a class="dropdown-item text-decoration-none" href="#">AutoEncoder &raquo;</a>
        <ul class="submenu dropdown-menu">
                <!-- block dropdown-menu -->
    <li>
        <a href="../simulai_models_autoencoder/" class="dropdown-item text-decoration-none ">Simulai models autoencoder</a>
    </li>
<!-- endblock -->
        </ul>
    </li>
<!-- endblock -->
                <!-- block dropdown-menu -->
    <li>
        <a class="dropdown-item text-decoration-none" href="#">U-Net &raquo;</a>
        <ul class="submenu dropdown-menu">
                <!-- block dropdown-menu -->
    <li>
        <a href="../simulai_models_unet/" class="dropdown-item text-decoration-none ">Simulai models unet</a>
    </li>
<!-- endblock -->
        </ul>
    </li>
<!-- endblock -->
        </ul>
    </li>
<!-- endblock -->
                            </ul>
                        </li>
            </ul>
        </li>
<!-- endblock -->
                </li>
                <!-- endblock -->

                <!-- block search -->
                <li class="nav-item">
                    <a class="collapsed" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                        <div class="md-search-icon">
                            <i class="fa fa-search" aria-hidden="true"></i>
                        </div>
                    </a>
                </li>
                <!--  endblock -->

                <!-- block source -->
                <li class="nav-item">
                    
                        
                            <!-- block source -->
<div class="md-source source-detail">
  <div class="md-source-repo-icon">
    <i class="fa fa-github-alt" aria-hidden="true"></i>
  </div>

  <div class="md-source-repo-url">
    <a href="https://github.com/IBM/simulai" class="md-source">
      IBM/simulai
    </a>

    <ul class="md-source-repo-text">
      <li>
        <i class="fa fa-tag" aria-hidden="true"></i>
        <img alt="GitHub tag (latest by date)"
          src="https://img.shields.io/github/v/tag/IBM/simulai?color=white&label=%20&style=flat-square">
      </li>

      <li>
        <i class="fa fa-star" aria-hidden="true"></i>
        <img alt="GitHub Repo stars"
          src="https://img.shields.io/github/stars/IBM/simulai?color=white&label=%20&style=flat-square">
      </li>

      <li>
        <i class="fa fa-code-fork" aria-hidden="true"></i>
        <img alt="GitHub forks"
          src="https://img.shields.io/github/forks/IBM/simulai?color=white&label=%20&style=flat-square">
      </li>
    </ul>
  </div>

</div>
<!--  endblock -->
                        
                    
                </li>
                <!--  endblock -->
            </ul>
        </div>
    </div>
</nav>
<!--  endblock -->
            </header>

            <main><!-- block search -->
<div class="collapse" id="collapseExample">
    <div role="search" class="search-box">
        <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
            <input type="text" name="q" class="search-query"
            placeholder="Search docs" title="Type search term here" />
        </form>
    </div>
</div>
<!-- endblock -->
                    <!-- block content -->
<section class="container post">
    <article>
        <header>
            
                <h1 class="bold title" id="component-title">Simulai models deeponet</h1>
            
        </header>
        <p><style>
red { color: red }
</style>

<h1 id="deeponets"><red>DeepONets</red><a class="headerlink" href="#deeponets" title="Permanent link">#</a></h1>
<h2 id="deeponet"><red>DeepONet</red><a class="headerlink" href="#deeponet" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-class">



<a id="simulai.models.DeepONet"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code></p>


            <details class="quote">
              <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DeepONet</span><span class="p">(</span><span class="n">NetworkTemplate</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;deeponet&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="s2">&quot;torch&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trunk_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">branch_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decoder_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># The decoder network is optional and considered</span>
        <span class="n">var_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># less effective than the output reshaping alternative</span>
        <span class="n">devices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
        <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rescale_factors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_bias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Classical Deep Operator Network (DeepONet), a deep learning version</span>
<span class="sd">        of the Universal Approximation Theorem.</span>

<span class="sd">        Args:</span>
<span class="sd">            trunk_network (NetworkTemplate, optional): Subnetwork for processing the coordinates inputs. (Default value = None)</span>
<span class="sd">            branch_network (NetworkTemplate, optional): Subnetwork for processing the forcing/conditioning inputs. (Default value = None)</span>
<span class="sd">            decoder_network (NetworkTemplate, optional): Subnetworks for converting the embedding to the output (optional). (Default value = None)</span>
<span class="sd">            devices (Union[str, list], optional):  Devices in which the model will be executed. (Default value = &quot;cpu&quot;)</span>
<span class="sd">            product_type (str, optional): Type of product to execute in the embedding space. (Default value = None)</span>
<span class="sd">            rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</span>
<span class="sd">            model_id (str, optional): Name for the model (Default value = None)</span>
<span class="sd">            use_bias (bool, optional):  (Default value = False)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">DeepONet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">)</span>

        <span class="c1"># Determining the kind of device to be used for allocating the</span>
        <span class="c1"># subnetworks used in the DeepONet model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_device</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span> <span class="o">=</span> <span class="n">use_bias</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">trunk_network</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">branch_network</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;trunk_network&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;branch_network&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">decoder_network</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
                <span class="n">entity</span><span class="o">=</span><span class="n">decoder_network</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;decoder_network&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span> <span class="o">=</span> <span class="n">decoder_network</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">product_type</span> <span class="o">=</span> <span class="n">product_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span> <span class="o">=</span> <span class="n">model_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span> <span class="o">=</span> <span class="n">var_dim</span>

        <span class="c1"># Rescaling factors for the output</span>
        <span class="k">if</span> <span class="n">rescale_factors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">rescale_factors</span><span class="p">)</span> <span class="o">==</span> <span class="n">var_dim</span>
            <span class="p">),</span> <span class="s2">&quot;The number of rescaling factors must be equal to var_dim.&quot;</span>
            <span class="n">rescale_factors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">rescale_factors</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rescale_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
                <span class="n">entity</span><span class="o">=</span><span class="n">rescale_factors</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rescale_factors</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Checking up whether the output of each subnetwork are in correct shape</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latent_dimension_is_correct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">output_size</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">&quot;The trunk network must have&quot;</span>
            <span class="s2">&quot; one-dimensional output , &quot;</span>
            <span class="s2">&quot;but received&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">output_size</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latent_dimension_is_correct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">&quot;The branch network must have&quot;</span>
            <span class="s2">&quot; one-dimensional output,&quot;</span>
            <span class="s2">&quot; but received&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># If bias is being used, check whether the network outputs are compatible.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bias is being used.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bias_compatibility_is_correct</span><span class="p">(</span>
                <span class="n">dim_trunk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">output_size</span><span class="p">,</span>
                <span class="n">dim_branch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_bias_active</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_bias_inactive</span>

        <span class="c1"># Using a decoder on top of the model or not</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decoder_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_decoder_active</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decoder_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_decoder_inactive</span>

        <span class="c1"># Using rescaling factors or not</span>
        <span class="k">if</span> <span class="n">rescale_factors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rescale_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_rescale_active</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rescale_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_rescale_inactive</span>

        <span class="c1"># Checking the compatibility of the subnetworks outputs for each kind of product being employed.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">product_type</span> <span class="o">!=</span> <span class="s2">&quot;dense&quot;</span><span class="p">:</span>
            <span class="n">output_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span>
            <span class="n">output_trunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">output_size</span>

            <span class="c1"># It checks if the inner product operation can be performed.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">output_branch</span> <span class="o">==</span> <span class="n">output_trunk</span><span class="p">,</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The output dimensions for the sub-networks&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; trunk and branch must be equal but are&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">output_branch</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; and </span><span class="si">{</span><span class="n">output_trunk</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bias compatibility was already verified.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span>

            <span class="k">assert</span> <span class="ow">not</span> <span class="n">output_branch</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="p">,</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The number of branch latent outputs must&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; be divisible by the number of variables,&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; but received </span><span class="si">{</span><span class="n">output_branch</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">net</span>
            <span class="k">for</span> <span class="n">net</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_trunk</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_branch</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># TODO Checking up if the input of the decoder network has the correct dimension</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Decoder is being used.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Selecting the correct forward approach to be used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_selector_</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;trunk&quot;</span><span class="p">,</span> <span class="s2">&quot;branch&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_latent_dimension_is_correct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;It checks if the latent dimension is consistent.</span>

<span class="sd">        Args:</span>
<span class="sd">            dim (Union[int, tuple]): Latent_space_dimension.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: The confirmation about the dimensionality correctness.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_bias_compatibility_is_correct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dim_trunk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">dim_branch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">dim_branch</span> <span class="o">==</span> <span class="n">dim_trunk</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;When using bias, the dimension&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;of the branch output should be&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;trunk output + var_dim.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_forward_dense</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">output_trunk</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_branch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Forward method used when the embeddings are multiplied using a matrix-like product, it means, the trunk</span>
<span class="sd">        network outputs serve as &quot;interpolation basis&quot; for the branch outputs.</span>

<span class="sd">        Args:</span>
<span class="sd">            output_trunk (torch.Tensor, optional): The embedding generated by the trunk network. (Default value = None)</span>
<span class="sd">            output_branch (torch.Tensor, optional): The embedding generated by the branch network. (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The product between the two embeddings.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">latent_dim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">output_branch</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="p">)</span>
        <span class="n">output_branch_reshaped</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="n">output_branch</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="p">,</span> <span class="n">latent_dim</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">output_branch_reshaped</span><span class="p">,</span> <span class="n">output_trunk</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_forward_pointwise</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">output_trunk</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_branch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Forward method used when the embeddings are multiplied using a simple point-wise product, after that a</span>
<span class="sd">        reshaping is applied in order to produce multiple outputs.</span>

<span class="sd">        Args:</span>
<span class="sd">            output_trunk (torch.Tensor, optional): The embedding generated by the trunk network. (Default value = None)</span>
<span class="sd">            output_branch (torch.Tensor, optional): The embedding generated by the branch network. (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The product between the two embeddings.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">latent_dim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">output_trunk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="p">)</span>
        <span class="n">output_trunk_reshaped</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="n">output_trunk</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">latent_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">output_branch_reshaped</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="n">output_branch</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">latent_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">output_trunk_reshaped</span> <span class="o">*</span> <span class="n">output_branch_reshaped</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_forward_vanilla</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">output_trunk</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_branch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Forward method used when the embeddings are multiplied using a simple point-wise product.</span>

<span class="sd">        Args:</span>
<span class="sd">            output_trunk (torch.Tensor, optional): The embedding generated by the trunk network. (Default value = None)</span>
<span class="sd">            output_branch (torch.Tensor, optional): The embedding generated by the branch network. (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The product between the two embeddings.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">output_trunk</span> <span class="o">*</span> <span class="n">output_branch</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_forward_selector_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;It selects the forward method to be used.</span>


<span class="sd">        Returns:</span>
<span class="sd">            callable : The callable corresponding to the required forward method.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># It operates as a typical dense layer</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">product_type</span> <span class="o">==</span> <span class="s2">&quot;dense&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_dense</span>
            <span class="c1"># It executes an inner product by parts between the outputs</span>
            <span class="c1"># of the subnetworks branch and trunk</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pointwise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_vanilla</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_var_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="c1"># It checks all the data arrays in self.var_map have the same</span>
        <span class="c1"># batches dimension</span>
        <span class="n">batches_dimensions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_map</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">batches_dimensions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">),</span> <span class="s2">&quot;This dataset is not proper to apply shuffling&quot;</span>

        <span class="n">dim</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">batches_dimensions</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

        <span class="n">var_map_shuffled</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">return</span> <span class="n">var_map_shuffled</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">net</span><span class="o">.</span><span class="n">weights</span> <span class="k">for</span> <span class="n">net</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks</span><span class="p">],</span> <span class="p">[])</span>

    <span class="c1"># Now, a sequence of wrappers</span>
    <span class="k">def</span> <span class="nf">_wrapper_bias_inactive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">output_trunk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_branch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span><span class="p">(</span><span class="n">output_trunk</span><span class="o">=</span><span class="n">output_trunk</span><span class="p">,</span> <span class="n">output_branch</span><span class="o">=</span><span class="n">output_branch</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_wrapper_bias_active</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">output_trunk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_branch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">output_branch_</span> <span class="o">=</span> <span class="n">output_branch</span><span class="p">[:,</span> <span class="p">:</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="p">]</span>
        <span class="n">bias</span> <span class="o">=</span> <span class="n">output_branch</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span> <span class="p">:]</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span><span class="p">(</span><span class="n">output_trunk</span><span class="o">=</span><span class="n">output_trunk</span><span class="p">,</span> <span class="n">output_branch</span><span class="o">=</span><span class="n">output_branch_</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">bias</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_wrapper_decoder_active</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_wrapper_decoder_inactive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">input_data</span>

    <span class="k">def</span> <span class="nf">_wrapper_rescale_active</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">input_data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_factors</span>

    <span class="k">def</span> <span class="nf">_wrapper_rescale_inactive</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">input_data</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_trunk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">input_branch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper forward method.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_trunk (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">            input_branch (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The result of all the hidden operations in the network.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Forward method execution</span>
        <span class="n">output_trunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_trunk</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="p">)</span>

        <span class="n">output_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_branch</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="p">)</span>

        <span class="c1"># Wrappers are applied to execute user-defined operations.</span>
        <span class="c1"># When those operations are not selected, these wrappers simply</span>
        <span class="c1"># bypass the inputs.</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_wrapper</span><span class="p">(</span>
            <span class="n">output_trunk</span><span class="o">=</span><span class="n">output_trunk</span><span class="p">,</span> <span class="n">output_branch</span><span class="o">=</span><span class="n">output_branch</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_wrapper</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decoder_wrapper</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">output</span><span class="p">))</span>

    <span class="nd">@guarantee_device</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trunk_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">branch_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;It uses the network to make evaluations.</span>

<span class="sd">        Args:</span>
<span class="sd">            trunk_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">            branch_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The result of all the hidden operations in the network.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_trunk</span><span class="o">=</span><span class="n">trunk_data</span><span class="p">,</span> <span class="n">input_branch</span><span class="o">=</span><span class="n">branch_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="nd">@guarantee_device</span>
    <span class="k">def</span> <span class="nf">eval_subnetwork</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;It evaluates the output of DeepONet subnetworks.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str, optional): Name of the subnetwork. (Default value = None)</span>
<span class="sd">            input_data (Union[np.ndarray, torch.Tensor], optional): The data used as input for the subnetwork. (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The evaluation performed by the subnetwork.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;The name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a subnetwork of </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">.&quot;</span>

        <span class="n">network_to_be_used</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_network&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">network_to_be_used</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trunk Network:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Branch Network:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="simulai.models.DeepONet.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">trunk_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">branch_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decoder_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">var_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">product_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rescale_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#simulai.models.DeepONet.__init__" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Classical Deep Operator Network (DeepONet), a deep learning version
of the Universal Approximation Theorem.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>trunk_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for processing the coordinates inputs. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>branch_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for processing the forcing/conditioning inputs. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>decoder_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetworks for converting the embedding to the output (optional). (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>devices</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Devices in which the model will be executed. (Default value = "cpu")</p>
            </div>
          </td>
          <td>
                <code>&#39;cpu&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>product_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Type of product to execute in the embedding space. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>rescale_factors</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>model_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name for the model (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>use_bias</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = False)</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">trunk_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">branch_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decoder_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># The decoder network is optional and considered</span>
    <span class="n">var_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># less effective than the output reshaping alternative</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
    <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rescale_factors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_bias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Classical Deep Operator Network (DeepONet), a deep learning version</span>
<span class="sd">    of the Universal Approximation Theorem.</span>

<span class="sd">    Args:</span>
<span class="sd">        trunk_network (NetworkTemplate, optional): Subnetwork for processing the coordinates inputs. (Default value = None)</span>
<span class="sd">        branch_network (NetworkTemplate, optional): Subnetwork for processing the forcing/conditioning inputs. (Default value = None)</span>
<span class="sd">        decoder_network (NetworkTemplate, optional): Subnetworks for converting the embedding to the output (optional). (Default value = None)</span>
<span class="sd">        devices (Union[str, list], optional):  Devices in which the model will be executed. (Default value = &quot;cpu&quot;)</span>
<span class="sd">        product_type (str, optional): Type of product to execute in the embedding space. (Default value = None)</span>
<span class="sd">        rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</span>
<span class="sd">        model_id (str, optional): Name for the model (Default value = None)</span>
<span class="sd">        use_bias (bool, optional):  (Default value = False)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">DeepONet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">)</span>

    <span class="c1"># Determining the kind of device to be used for allocating the</span>
    <span class="c1"># subnetworks used in the DeepONet model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_device</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span> <span class="o">=</span> <span class="n">use_bias</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">trunk_network</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">branch_network</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;trunk_network&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;branch_network&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">decoder_network</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">decoder_network</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;decoder_network&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span> <span class="o">=</span> <span class="n">decoder_network</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">product_type</span> <span class="o">=</span> <span class="n">product_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span> <span class="o">=</span> <span class="n">model_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span> <span class="o">=</span> <span class="n">var_dim</span>

    <span class="c1"># Rescaling factors for the output</span>
    <span class="k">if</span> <span class="n">rescale_factors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">rescale_factors</span><span class="p">)</span> <span class="o">==</span> <span class="n">var_dim</span>
        <span class="p">),</span> <span class="s2">&quot;The number of rescaling factors must be equal to var_dim.&quot;</span>
        <span class="n">rescale_factors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">rescale_factors</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rescale_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">rescale_factors</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rescale_factors</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Checking up whether the output of each subnetwork are in correct shape</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latent_dimension_is_correct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">output_size</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">&quot;The trunk network must have&quot;</span>
        <span class="s2">&quot; one-dimensional output , &quot;</span>
        <span class="s2">&quot;but received&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">output_size</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latent_dimension_is_correct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">&quot;The branch network must have&quot;</span>
        <span class="s2">&quot; one-dimensional output,&quot;</span>
        <span class="s2">&quot; but received&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># If bias is being used, check whether the network outputs are compatible.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bias is being used.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bias_compatibility_is_correct</span><span class="p">(</span>
            <span class="n">dim_trunk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">output_size</span><span class="p">,</span>
            <span class="n">dim_branch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_bias_active</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_bias_inactive</span>

    <span class="c1"># Using a decoder on top of the model or not</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_decoder_active</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_decoder_inactive</span>

    <span class="c1"># Using rescaling factors or not</span>
    <span class="k">if</span> <span class="n">rescale_factors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rescale_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_rescale_active</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rescale_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapper_rescale_inactive</span>

    <span class="c1"># Checking the compatibility of the subnetworks outputs for each kind of product being employed.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">product_type</span> <span class="o">!=</span> <span class="s2">&quot;dense&quot;</span><span class="p">:</span>
        <span class="n">output_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span>
        <span class="n">output_trunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">output_size</span>

        <span class="c1"># It checks if the inner product operation can be performed.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bias</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">output_branch</span> <span class="o">==</span> <span class="n">output_trunk</span><span class="p">,</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The output dimensions for the sub-networks&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; trunk and branch must be equal but are&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">output_branch</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; and </span><span class="si">{</span><span class="n">output_trunk</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bias compatibility was already verified.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">output_size</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="n">output_branch</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="p">,</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The number of branch latent outputs must&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; be divisible by the number of variables,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; but received </span><span class="si">{</span><span class="n">output_branch</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_dim</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">net</span>
        <span class="k">for</span> <span class="n">net</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">input_trunk</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_branch</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">var_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># TODO Checking up if the input of the decoder network has the correct dimension</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_network</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Decoder is being used.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Selecting the correct forward approach to be used</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_selector_</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;trunk&quot;</span><span class="p">,</span> <span class="s2">&quot;branch&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="simulai.models.DeepONet.eval" class="doc doc-heading">
          <code class="highlight language-python"><span class="nb">eval</span><span class="p">(</span><span class="n">trunk_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">branch_data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#simulai.models.DeepONet.eval" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>It uses the network to make evaluations.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>trunk_data</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>branch_data</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.ndarray: The result of all the hidden operations in the network.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@guarantee_device</span>
<span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">trunk_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">branch_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;It uses the network to make evaluations.</span>

<span class="sd">    Args:</span>
<span class="sd">        trunk_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">        branch_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The result of all the hidden operations in the network.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_trunk</span><span class="o">=</span><span class="n">trunk_data</span><span class="p">,</span> <span class="n">input_branch</span><span class="o">=</span><span class="n">branch_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="simulai.models.DeepONet.eval_subnetwork" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">eval_subnetwork</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#simulai.models.DeepONet.eval_subnetwork" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>It evaluates the output of DeepONet subnetworks.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the subnetwork. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_data</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The data used as input for the subnetwork. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.ndarray: The evaluation performed by the subnetwork.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@guarantee_device</span>
<span class="k">def</span> <span class="nf">eval_subnetwork</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;It evaluates the output of DeepONet subnetworks.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str, optional): Name of the subnetwork. (Default value = None)</span>
<span class="sd">        input_data (Union[np.ndarray, torch.Tensor], optional): The data used as input for the subnetwork. (Default value = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The evaluation performed by the subnetwork.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;The name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a subnetwork of </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">.&quot;</span>

    <span class="n">network_to_be_used</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_network&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">network_to_be_used</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="simulai.models.DeepONet.forward" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">input_trunk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_branch</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#simulai.models.DeepONet.forward" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Wrapper forward method.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_trunk</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_branch</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>torch.Tensor: The result of all the hidden operations in the network.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_trunk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">input_branch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper forward method.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_trunk (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">        input_branch (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        torch.Tensor: The result of all the hidden operations in the network.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Forward method execution</span>
    <span class="n">output_trunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
        <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_trunk</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
    <span class="p">)</span>

    <span class="n">output_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
        <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_branch</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
    <span class="p">)</span>

    <span class="c1"># Wrappers are applied to execute user-defined operations.</span>
    <span class="c1"># When those operations are not selected, these wrappers simply</span>
    <span class="c1"># bypass the inputs.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_wrapper</span><span class="p">(</span>
        <span class="n">output_trunk</span><span class="o">=</span><span class="n">output_trunk</span><span class="p">,</span> <span class="n">output_branch</span><span class="o">=</span><span class="n">output_branch</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_wrapper</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decoder_wrapper</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">output</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="resdeeponet"><red>ResDeepONet</red><a class="headerlink" href="#resdeeponet" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-class">



<a id="simulai.models.ResDeepONet"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="simulai.models._pytorch_models._deeponet.DeepONet" href="#simulai.models.DeepONet">DeepONet</a></code></p>


            <details class="quote">
              <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ResDeepONet</span><span class="p">(</span><span class="n">DeepONet</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;resdeeponet&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="s2">&quot;torch&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trunk_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">branch_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decoder_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># The decoder network is optional and considered</span>
        <span class="n">var_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># less effective than the output reshaping alternative</span>
        <span class="n">devices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
        <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rescale_factors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">residual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">multiply_by_trunk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_bias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Residual Deep Operator Network (DeepONet)</span>

<span class="sd">        The operation performed is: output = input_branch + D(param, input_branch)</span>

<span class="sd">        Args:</span>
<span class="sd">            trunk_network (NetworkTemplate, optional): Subnetwork for processing the coordinates inputs (Default value = None)</span>
<span class="sd">            branch_network (NetworkTemplate, optional): Subnetwork for processing the forcing/conditioning inputs (Default value = None)</span>
<span class="sd">            decoder_network (NetworkTemplate, optional): Subnetworks for converting the embedding to the output (optional) (Default value = None)</span>
<span class="sd">            # (Union[str, list], optional):  (Default value = &quot;cpu&quot;)</span>
<span class="sd">            product_type (str, optional): Type of product to execute in the embedding space (Default value = None)</span>
<span class="sd">            rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</span>
<span class="sd">            residual (bool, optional): Consider the DeepONet as a residual layer (sum the output to the branch input) or not. (Default value = True)</span>
<span class="sd">            multiply_by_trunk (bool, optional): Multiply the output by the trunk input or not. NOTE: if the option &#39;residual&#39;</span>
<span class="sd">        is activated it is performed after the multiplication:</span>
<span class="sd">        `output*trunk_input + branch_input` (Default value = False)</span>
<span class="sd">            model_id (str, optional): Name for the model (Default value = None)</span>
<span class="sd">            use_bias (bool, optional):  (Default value = False)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ResDeepONet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">trunk_network</span><span class="o">=</span><span class="n">trunk_network</span><span class="p">,</span>
            <span class="n">branch_network</span><span class="o">=</span><span class="n">branch_network</span><span class="p">,</span>
            <span class="n">decoder_network</span><span class="o">=</span><span class="n">decoder_network</span><span class="p">,</span>  <span class="c1"># The decoder network is optional and considered</span>
            <span class="n">var_dim</span><span class="o">=</span><span class="n">var_dim</span><span class="p">,</span>  <span class="c1"># less effective than the output reshaping alternative</span>
            <span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span>
            <span class="n">product_type</span><span class="o">=</span><span class="n">product_type</span><span class="p">,</span>
            <span class="n">rescale_factors</span><span class="o">=</span><span class="n">rescale_factors</span><span class="p">,</span>
            <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">input_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">input_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">forward_</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span>

        <span class="k">if</span> <span class="n">residual</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">input_dim</span> <span class="o">==</span> <span class="n">var_dim</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">&quot;For a residual network, it is necessary to have &quot;</span>
                <span class="s2">&quot;size of branch_network input equal to var_dim, but &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">input_dim</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">var_dim</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_default</span>

        <span class="k">elif</span> <span class="n">multiply_by_trunk</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_multiplied_by_trunk</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_cut_residual</span>

    <span class="k">def</span> <span class="nf">_forward_default</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_trunk</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">input_branch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Forward method which considers the network a residual operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_trunk (torch.Tensor, optional):  (Default value = None)</span>
<span class="sd">            input_branch (torch.Tensor, optional):  (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The product between the two embeddings.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output_residual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_</span><span class="p">(</span>
            <span class="n">input_trunk</span><span class="o">=</span><span class="n">input_trunk</span><span class="p">,</span> <span class="n">input_branch</span><span class="o">=</span><span class="n">input_branch</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">input_branch</span> <span class="o">+</span> <span class="n">output_residual</span>

    <span class="k">def</span> <span class="nf">_forward_multiplied_by_trunk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_trunk</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">input_branch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Forward method with multiplication by the trunk embedding.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_trunk (torch.Tensor, optional):  (Default value = None)</span>
<span class="sd">            input_branch (torch.Tensor, optional):  (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The product between the two embeddings.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output_residual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_</span><span class="p">(</span>
            <span class="n">input_trunk</span><span class="o">=</span><span class="n">input_trunk</span><span class="p">,</span> <span class="n">input_branch</span><span class="o">=</span><span class="n">input_branch</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">input_branch</span> <span class="o">+</span> <span class="n">output_residual</span> <span class="o">*</span> <span class="n">input_trunk</span>

    <span class="k">def</span> <span class="nf">_forward_cut_residual</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_trunk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">input_branch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Forward method in which the residual operation is ignored.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_trunk (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">            input_branch (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The product between the two embeddings.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_</span><span class="p">(</span><span class="n">input_trunk</span><span class="o">=</span><span class="n">input_trunk</span><span class="p">,</span> <span class="n">input_branch</span><span class="o">=</span><span class="n">input_branch</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="simulai.models.ResDeepONet.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">trunk_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">branch_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decoder_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">var_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">product_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rescale_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residual</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multiply_by_trunk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#simulai.models.ResDeepONet.__init__" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Residual Deep Operator Network (DeepONet)</p>
<p>The operation performed is: output = input_branch + D(param, input_branch)</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>trunk_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for processing the coordinates inputs (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>branch_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for processing the forcing/conditioning inputs (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>decoder_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetworks for converting the embedding to the output (optional) (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>#</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, list]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = "cpu")</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>product_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Type of product to execute in the embedding space (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>rescale_factors</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>residual</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Consider the DeepONet as a residual layer (sum the output to the branch input) or not. (Default value = True)</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>multiply_by_trunk</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Multiply the output by the trunk input or not. NOTE: if the option 'residual'</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>is activated it is performed after the multiplication:
<code>output*trunk_input + branch_input</code> (Default value = False)
    model_id (str, optional): Name for the model (Default value = None)
    use_bias (bool, optional):  (Default value = False)</p>

          <details class="quote">
            <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">trunk_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">branch_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decoder_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># The decoder network is optional and considered</span>
    <span class="n">var_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># less effective than the output reshaping alternative</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
    <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rescale_factors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">residual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">multiply_by_trunk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_bias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Residual Deep Operator Network (DeepONet)</span>

<span class="sd">    The operation performed is: output = input_branch + D(param, input_branch)</span>

<span class="sd">    Args:</span>
<span class="sd">        trunk_network (NetworkTemplate, optional): Subnetwork for processing the coordinates inputs (Default value = None)</span>
<span class="sd">        branch_network (NetworkTemplate, optional): Subnetwork for processing the forcing/conditioning inputs (Default value = None)</span>
<span class="sd">        decoder_network (NetworkTemplate, optional): Subnetworks for converting the embedding to the output (optional) (Default value = None)</span>
<span class="sd">        # (Union[str, list], optional):  (Default value = &quot;cpu&quot;)</span>
<span class="sd">        product_type (str, optional): Type of product to execute in the embedding space (Default value = None)</span>
<span class="sd">        rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</span>
<span class="sd">        residual (bool, optional): Consider the DeepONet as a residual layer (sum the output to the branch input) or not. (Default value = True)</span>
<span class="sd">        multiply_by_trunk (bool, optional): Multiply the output by the trunk input or not. NOTE: if the option &#39;residual&#39;</span>
<span class="sd">    is activated it is performed after the multiplication:</span>
<span class="sd">    `output*trunk_input + branch_input` (Default value = False)</span>
<span class="sd">        model_id (str, optional): Name for the model (Default value = None)</span>
<span class="sd">        use_bias (bool, optional):  (Default value = False)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">ResDeepONet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">trunk_network</span><span class="o">=</span><span class="n">trunk_network</span><span class="p">,</span>
        <span class="n">branch_network</span><span class="o">=</span><span class="n">branch_network</span><span class="p">,</span>
        <span class="n">decoder_network</span><span class="o">=</span><span class="n">decoder_network</span><span class="p">,</span>  <span class="c1"># The decoder network is optional and considered</span>
        <span class="n">var_dim</span><span class="o">=</span><span class="n">var_dim</span><span class="p">,</span>  <span class="c1"># less effective than the output reshaping alternative</span>
        <span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span>
        <span class="n">product_type</span><span class="o">=</span><span class="n">product_type</span><span class="p">,</span>
        <span class="n">rescale_factors</span><span class="o">=</span><span class="n">rescale_factors</span><span class="p">,</span>
        <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">input_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">input_size</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">forward_</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span>

    <span class="k">if</span> <span class="n">residual</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">input_dim</span> <span class="o">==</span> <span class="n">var_dim</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;For a residual network, it is necessary to have &quot;</span>
            <span class="s2">&quot;size of branch_network input equal to var_dim, but &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">input_dim</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">var_dim</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_default</span>

    <span class="k">elif</span> <span class="n">multiply_by_trunk</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_multiplied_by_trunk</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_cut_residual</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="improveddeeponet"><red>ImprovedDeepONet</red><a class="headerlink" href="#improveddeeponet" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-class">



<a id="simulai.models.ImprovedDeepONet"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="simulai.models._pytorch_models._deeponet.ResDeepONet" href="#simulai.models.ResDeepONet">ResDeepONet</a></code></p>


            <details class="quote">
              <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImprovedDeepONet</span><span class="p">(</span><span class="n">ResDeepONet</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;improveddeeponet&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="s2">&quot;torch&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trunk_network</span><span class="p">:</span> <span class="n">ConvexDenseNetwork</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">branch_network</span><span class="p">:</span> <span class="n">ConvexDenseNetwork</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decoder_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoder_trunk</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoder_branch</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">var_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">devices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
        <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rescale_factors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">residual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">multiply_by_trunk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_bias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The so-called Improved DeepONet architecture aims at enhancing the communication</span>
<span class="sd">        between the trunk and branch pipelines during the training process, thus allowing</span>
<span class="sd">                    better generalization capabilities for the composite model.</span>

<span class="sd">        Args:</span>
<span class="sd">            trunk_network (ConvexDenseNetwork, optional): Subnetwork for processing the coordinates inputs. (Default value = None)</span>
<span class="sd">            branch_network (ConvexDenseNetwork, optional): Subnetwork for processing the forcing/conditioning inputs. (Default value = None)</span>
<span class="sd">            decoder_network (NetworkTemplate, optional): Subnetwork for converting the embedding to the output (optional). (Default value = None)</span>
<span class="sd">            encoder_trunk (NetworkTemplate, optional): Shallow subnework used to map the trunk input to an auxiliary embedding</span>
<span class="sd">        employed in combination with the hidden spaces. (Default value = None)</span>
<span class="sd">            encoder_branch (NetworkTemplate, optional): Shallow subnework used to map the branch input to an auxiliary embedding</span>
<span class="sd">        employed in combination with the hidden spaces. (Default value = None)</span>
<span class="sd">            var_dim (int, optional): Number of output variables. (Default value = 1)</span>
<span class="sd">            devices (Union[str, list], optional): Devices in which the model will be executed. (Default value = &quot;cpu&quot;)</span>
<span class="sd">            product_type (str, optional): Type of product to execute in the embedding space. (Default value = None)</span>
<span class="sd">            rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</span>
<span class="sd">            residual (bool, optional):  (Default value = False)</span>
<span class="sd">            multiply_by_trunk (bool, optional):  (Default value = False)</span>
<span class="sd">            model_id (str, optional): Name for the model (Default value = None)</span>
<span class="sd">            use_bias (bool, optional):  (Default value = False)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Guaranteeing the compatibility between the encoders and the branch and trunk networks</span>
        <span class="n">t_hs</span> <span class="o">=</span> <span class="n">trunk_network</span><span class="o">.</span><span class="n">hidden_size</span>
        <span class="n">et_os</span> <span class="o">=</span> <span class="n">encoder_trunk</span><span class="o">.</span><span class="n">output_size</span>
        <span class="n">b_hs</span> <span class="o">=</span> <span class="n">branch_network</span><span class="o">.</span><span class="n">hidden_size</span>
        <span class="n">eb_os</span> <span class="o">=</span> <span class="n">encoder_branch</span><span class="o">.</span><span class="n">output_size</span>

        <span class="k">assert</span> <span class="n">t_hs</span> <span class="o">==</span> <span class="n">et_os</span> <span class="o">==</span> <span class="n">b_hs</span> <span class="o">==</span> <span class="n">eb_os</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;The output of the trunk encoder must have the same dimension&quot;</span>
            <span class="s2">&quot; of the trunk network hidden size, but got&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">encoder_trunk</span><span class="o">.</span><span class="n">output_size</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">hidden_size</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ImprovedDeepONet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">trunk_network</span><span class="o">=</span><span class="n">trunk_network</span><span class="p">,</span>
            <span class="n">branch_network</span><span class="o">=</span><span class="n">branch_network</span><span class="p">,</span>
            <span class="n">decoder_network</span><span class="o">=</span><span class="n">decoder_network</span><span class="p">,</span>
            <span class="n">var_dim</span><span class="o">=</span><span class="n">var_dim</span><span class="p">,</span>
            <span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span>
            <span class="n">product_type</span><span class="o">=</span><span class="n">product_type</span><span class="p">,</span>
            <span class="n">rescale_factors</span><span class="o">=</span><span class="n">rescale_factors</span><span class="p">,</span>
            <span class="n">residual</span><span class="o">=</span><span class="n">residual</span><span class="p">,</span>
            <span class="n">multiply_by_trunk</span><span class="o">=</span><span class="n">multiply_by_trunk</span><span class="p">,</span>
            <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encoder_trunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">encoder_trunk</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">encoder_branch</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;encoder_trunk&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_trunk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;encoder_branch&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_branch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">forward_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_improved</span>

    <span class="k">def</span> <span class="nf">_forward_improved</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_trunk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">input_branch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Improved forward method.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_trunk (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">            input_branch (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The product between the two embeddings.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Forward method execution</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_trunk</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_trunk</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_branch</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_branch</span><span class="p">)</span>

        <span class="n">output_trunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_trunk</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">),</span>
            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">output_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_branch</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">),</span>
            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span><span class="p">(</span><span class="n">output_trunk</span><span class="o">=</span><span class="n">output_trunk</span><span class="p">,</span> <span class="n">output_branch</span><span class="o">=</span><span class="n">output_branch</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_wrapper</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="nd">@guarantee_device</span>
    <span class="k">def</span> <span class="nf">eval_subnetwork</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trunk_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">branch_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;It evaluates the output of ImprovedDeepONet subnetworks.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str, optional): Name of the subnetwork. (Default value = None)</span>
<span class="sd">            trunk_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">            branch_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The evaluation performed by the subnetwork.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;The name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a subnetwork of </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">.&quot;</span>

        <span class="n">network_instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_network&quot;</span><span class="p">)</span>
        <span class="n">input_data</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_data&quot;</span><span class="p">]</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_trunk</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">trunk_data</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_branch</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">branch_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">network_instance</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_data</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
            <span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
            <span class="o">.</span><span class="n">detach</span><span class="p">()</span>
            <span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trunk Network:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Encoder Trunk:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder_trunk</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Encoder Branch:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder_branch</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Branch Network:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="simulai.models.ImprovedDeepONet.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">trunk_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">branch_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decoder_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoder_trunk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoder_branch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">var_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">product_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rescale_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">multiply_by_trunk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#simulai.models.ImprovedDeepONet.__init__" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>The so-called Improved DeepONet architecture aims at enhancing the communication
between the trunk and branch pipelines during the training process, thus allowing
            better generalization capabilities for the composite model.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>trunk_network</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="simulai.regression.ConvexDenseNetwork" href="../../simulai_regression/#simulai.regression.ConvexDenseNetwork">ConvexDenseNetwork</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for processing the coordinates inputs. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>branch_network</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="simulai.regression.ConvexDenseNetwork" href="../../simulai_regression/#simulai.regression.ConvexDenseNetwork">ConvexDenseNetwork</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for processing the forcing/conditioning inputs. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>decoder_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for converting the embedding to the output (optional). (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>encoder_trunk</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Shallow subnework used to map the trunk input to an auxiliary embedding</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>employed in combination with the hidden spaces. (Default value = None)
    encoder_branch (NetworkTemplate, optional): Shallow subnework used to map the branch input to an auxiliary embedding
employed in combination with the hidden spaces. (Default value = None)
    var_dim (int, optional): Number of output variables. (Default value = 1)
    devices (Union[str, list], optional): Devices in which the model will be executed. (Default value = "cpu")
    product_type (str, optional): Type of product to execute in the embedding space. (Default value = None)
    rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)
    residual (bool, optional):  (Default value = False)
    multiply_by_trunk (bool, optional):  (Default value = False)
    model_id (str, optional): Name for the model (Default value = None)
    use_bias (bool, optional):  (Default value = False)</p>

          <details class="quote">
            <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">trunk_network</span><span class="p">:</span> <span class="n">ConvexDenseNetwork</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">branch_network</span><span class="p">:</span> <span class="n">ConvexDenseNetwork</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decoder_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoder_trunk</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoder_branch</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
    <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rescale_factors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">residual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">multiply_by_trunk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_bias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The so-called Improved DeepONet architecture aims at enhancing the communication</span>
<span class="sd">    between the trunk and branch pipelines during the training process, thus allowing</span>
<span class="sd">                better generalization capabilities for the composite model.</span>

<span class="sd">    Args:</span>
<span class="sd">        trunk_network (ConvexDenseNetwork, optional): Subnetwork for processing the coordinates inputs. (Default value = None)</span>
<span class="sd">        branch_network (ConvexDenseNetwork, optional): Subnetwork for processing the forcing/conditioning inputs. (Default value = None)</span>
<span class="sd">        decoder_network (NetworkTemplate, optional): Subnetwork for converting the embedding to the output (optional). (Default value = None)</span>
<span class="sd">        encoder_trunk (NetworkTemplate, optional): Shallow subnework used to map the trunk input to an auxiliary embedding</span>
<span class="sd">    employed in combination with the hidden spaces. (Default value = None)</span>
<span class="sd">        encoder_branch (NetworkTemplate, optional): Shallow subnework used to map the branch input to an auxiliary embedding</span>
<span class="sd">    employed in combination with the hidden spaces. (Default value = None)</span>
<span class="sd">        var_dim (int, optional): Number of output variables. (Default value = 1)</span>
<span class="sd">        devices (Union[str, list], optional): Devices in which the model will be executed. (Default value = &quot;cpu&quot;)</span>
<span class="sd">        product_type (str, optional): Type of product to execute in the embedding space. (Default value = None)</span>
<span class="sd">        rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</span>
<span class="sd">        residual (bool, optional):  (Default value = False)</span>
<span class="sd">        multiply_by_trunk (bool, optional):  (Default value = False)</span>
<span class="sd">        model_id (str, optional): Name for the model (Default value = None)</span>
<span class="sd">        use_bias (bool, optional):  (Default value = False)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Guaranteeing the compatibility between the encoders and the branch and trunk networks</span>
    <span class="n">t_hs</span> <span class="o">=</span> <span class="n">trunk_network</span><span class="o">.</span><span class="n">hidden_size</span>
    <span class="n">et_os</span> <span class="o">=</span> <span class="n">encoder_trunk</span><span class="o">.</span><span class="n">output_size</span>
    <span class="n">b_hs</span> <span class="o">=</span> <span class="n">branch_network</span><span class="o">.</span><span class="n">hidden_size</span>
    <span class="n">eb_os</span> <span class="o">=</span> <span class="n">encoder_branch</span><span class="o">.</span><span class="n">output_size</span>

    <span class="k">assert</span> <span class="n">t_hs</span> <span class="o">==</span> <span class="n">et_os</span> <span class="o">==</span> <span class="n">b_hs</span> <span class="o">==</span> <span class="n">eb_os</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">&quot;The output of the trunk encoder must have the same dimension&quot;</span>
        <span class="s2">&quot; of the trunk network hidden size, but got&quot;</span>
        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">encoder_trunk</span><span class="o">.</span><span class="n">output_size</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">hidden_size</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">ImprovedDeepONet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">trunk_network</span><span class="o">=</span><span class="n">trunk_network</span><span class="p">,</span>
        <span class="n">branch_network</span><span class="o">=</span><span class="n">branch_network</span><span class="p">,</span>
        <span class="n">decoder_network</span><span class="o">=</span><span class="n">decoder_network</span><span class="p">,</span>
        <span class="n">var_dim</span><span class="o">=</span><span class="n">var_dim</span><span class="p">,</span>
        <span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span>
        <span class="n">product_type</span><span class="o">=</span><span class="n">product_type</span><span class="p">,</span>
        <span class="n">rescale_factors</span><span class="o">=</span><span class="n">rescale_factors</span><span class="p">,</span>
        <span class="n">residual</span><span class="o">=</span><span class="n">residual</span><span class="p">,</span>
        <span class="n">multiply_by_trunk</span><span class="o">=</span><span class="n">multiply_by_trunk</span><span class="p">,</span>
        <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">encoder_trunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">encoder_trunk</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoder_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">encoder_branch</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;encoder_trunk&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_trunk</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;encoder_branch&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_branch</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">forward_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_improved</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="simulai.models.ImprovedDeepONet.eval_subnetwork" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">eval_subnetwork</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trunk_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">branch_data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#simulai.models.ImprovedDeepONet.eval_subnetwork" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>It evaluates the output of ImprovedDeepONet subnetworks.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the subnetwork. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>trunk_data</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>branch_data</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.ndarray: The evaluation performed by the subnetwork.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@guarantee_device</span>
<span class="k">def</span> <span class="nf">eval_subnetwork</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trunk_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">branch_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;It evaluates the output of ImprovedDeepONet subnetworks.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str, optional): Name of the subnetwork. (Default value = None)</span>
<span class="sd">        trunk_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">        branch_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The evaluation performed by the subnetwork.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;The name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a subnetwork of </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">.&quot;</span>

    <span class="n">network_instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_network&quot;</span><span class="p">)</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_data&quot;</span><span class="p">]</span>

    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_trunk</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">trunk_data</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_branch</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">branch_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">network_instance</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_data</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="flexibledeeponet"><red>FlexibleDeepONet</red><a class="headerlink" href="#flexibledeeponet" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-class">



<a id="simulai.models.FlexibleDeepONet"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="simulai.models._pytorch_models._deeponet.ResDeepONet" href="#simulai.models.ResDeepONet">ResDeepONet</a></code></p>


            <details class="quote">
              <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FlexibleDeepONet</span><span class="p">(</span><span class="n">ResDeepONet</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;flexibledeeponet&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="s2">&quot;torch&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trunk_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">branch_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decoder_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pre_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">var_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">devices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
        <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rescale_factors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">residual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">multiply_by_trunk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_bias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flexible DeepONet uses a subnetwork called &#39;pre-network&#39;, which</span>
<span class="sd">                    plays the role of rescaling the trunk input according to the branch input.</span>
<span class="sd">        It is an attempt of reducing the training bias related to the different</span>
<span class="sd">                    orders of magnitude contained in the dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            trunk_network (NetworkTemplate, optional): Subnetwork for processing the coordinates inputs. (Default value = None)</span>
<span class="sd">            branch_network (NetworkTemplate, optional): Subnetwork for processing the forcing/conditioning inputs. (Default value = None)</span>
<span class="sd">            decoder_network (NetworkTemplate, optional): Subnetwork for converting the embedding to the output (optional). (Default value = None)</span>
<span class="sd">            pre_network (NetworkTemplate, optional): Subnework used to predict rescaling parameters for the trunk input</span>
<span class="sd">        accordingly the branch input. (Default value = None)</span>
<span class="sd">            var_dim (int, optional): Number of output variables. (Default value = 1)</span>
<span class="sd">            devices (Union[str, list], optional): Devices in which the model will be executed. (Default value = &quot;cpu&quot;)</span>
<span class="sd">            product_type (str, optional): Type of product to execute in the embedding space. (Default value = None)</span>
<span class="sd">            rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</span>
<span class="sd">            residual (bool, optional):  (Default value = False)</span>
<span class="sd">            multiply_by_trunk (bool, optional):  (Default value = False)</span>
<span class="sd">            model_id (str, optional): Name for the model (Default value = None)</span>
<span class="sd">            use_bias (bool, optional):  (Default value = False)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Guaranteeing the compatibility between the pre and the branch and trunk networks</span>
        <span class="n">t_is</span> <span class="o">=</span> <span class="n">trunk_network</span><span class="o">.</span><span class="n">input_size</span>
        <span class="n">p_is</span> <span class="o">=</span> <span class="n">pre_network</span><span class="o">.</span><span class="n">input_size</span>
        <span class="n">p_os</span> <span class="o">=</span> <span class="n">pre_network</span><span class="o">.</span><span class="n">output_size</span>
        <span class="n">b_is</span> <span class="o">=</span> <span class="n">branch_network</span><span class="o">.</span><span class="n">input_size</span>

        <span class="k">assert</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t_is</span> <span class="o">==</span> <span class="n">p_os</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b_is</span> <span class="o">==</span> <span class="n">p_is</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">&quot;The input of branch and pre networks must have the same dimension&quot;</span>
            <span class="s2">&quot; and the output of pre and the input of trunks, too, but got&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="p">(</span><span class="n">b_is</span><span class="p">,</span><span class="w"> </span><span class="n">p_is</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="p">(</span><span class="n">t_is</span><span class="p">,</span><span class="w"> </span><span class="n">p_os</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t_is</span> <span class="o">=</span> <span class="n">t_is</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">FlexibleDeepONet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">trunk_network</span><span class="o">=</span><span class="n">trunk_network</span><span class="p">,</span>
            <span class="n">branch_network</span><span class="o">=</span><span class="n">branch_network</span><span class="p">,</span>
            <span class="n">decoder_network</span><span class="o">=</span><span class="n">decoder_network</span><span class="p">,</span>
            <span class="n">var_dim</span><span class="o">=</span><span class="n">var_dim</span><span class="p">,</span>
            <span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span>
            <span class="n">product_type</span><span class="o">=</span><span class="n">product_type</span><span class="p">,</span>
            <span class="n">rescale_factors</span><span class="o">=</span><span class="n">rescale_factors</span><span class="p">,</span>
            <span class="n">residual</span><span class="o">=</span><span class="n">residual</span><span class="p">,</span>
            <span class="n">multiply_by_trunk</span><span class="o">=</span><span class="n">multiply_by_trunk</span><span class="p">,</span>
            <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pre_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">pre_network</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_flexible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_network</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;pre&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_rescaling_operation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rescaling_tensor</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">angular</span> <span class="o">=</span> <span class="n">rescaling_tensor</span><span class="p">[:,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_is</span><span class="p">]</span>
        <span class="n">linear</span> <span class="o">=</span> <span class="n">rescaling_tensor</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_is</span> <span class="p">:]</span>

        <span class="k">return</span> <span class="n">angular</span> <span class="o">*</span> <span class="n">input_data</span> <span class="o">+</span> <span class="n">linear</span>

    <span class="k">def</span> <span class="nf">_forward_flexible</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_trunk</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">input_branch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flexible forward method.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_trunk (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">            input_branch (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The product between the two embeddings.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Forward method execution</span>
        <span class="n">output_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_branch</span><span class="p">),</span>
            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">rescaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_branch</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="p">)</span>

        <span class="n">input_trunk_rescaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescaling_operation</span><span class="p">(</span>
            <span class="n">input_data</span><span class="o">=</span><span class="n">input_trunk</span><span class="p">,</span> <span class="n">rescaling_tensor</span><span class="o">=</span><span class="n">rescaling</span>
        <span class="p">)</span>

        <span class="n">output_trunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_trunk_rescaled</span><span class="p">),</span>
            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span><span class="p">(</span><span class="n">output_trunk</span><span class="o">=</span><span class="n">output_trunk</span><span class="p">,</span> <span class="n">output_branch</span><span class="o">=</span><span class="n">output_branch</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_wrapper</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="nd">@guarantee_device</span>
    <span class="k">def</span> <span class="nf">eval_subnetwork</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trunk_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">branch_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;It evaluates the output of FlexibleDeepONet subnetworks.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str, optional): Name of the subnetwork. (Default value = None)</span>
<span class="sd">            trunk_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">            branch_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The evaluation performed by the subnetwork.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;The name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a subnetwork of </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">.&quot;</span>

        <span class="c1"># Pre and branch network has the same input</span>
        <span class="n">pre_data</span> <span class="o">=</span> <span class="n">branch_data</span>

        <span class="n">network_instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_network&quot;</span><span class="p">)</span>
        <span class="n">input_data</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_data&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">network_instance</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trunk Network:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trunk_network</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pre Network:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_network</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Branch Network:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">branch_network</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="simulai.models.FlexibleDeepONet.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">trunk_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">branch_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decoder_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pre_network</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">var_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">product_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rescale_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">multiply_by_trunk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#simulai.models.FlexibleDeepONet.__init__" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>Flexible DeepONet uses a subnetwork called 'pre-network', which
            plays the role of rescaling the trunk input according to the branch input.
It is an attempt of reducing the training bias related to the different
            orders of magnitude contained in the dataset.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>trunk_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for processing the coordinates inputs. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>branch_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for processing the forcing/conditioning inputs. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>decoder_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnetwork for converting the embedding to the output (optional). (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>pre_network</code></td>
          <td>
                <code><span title="simulai.templates.NetworkTemplate">NetworkTemplate</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subnework used to predict rescaling parameters for the trunk input</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>accordingly the branch input. (Default value = None)
    var_dim (int, optional): Number of output variables. (Default value = 1)
    devices (Union[str, list], optional): Devices in which the model will be executed. (Default value = "cpu")
    product_type (str, optional): Type of product to execute in the embedding space. (Default value = None)
    rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)
    residual (bool, optional):  (Default value = False)
    multiply_by_trunk (bool, optional):  (Default value = False)
    model_id (str, optional): Name for the model (Default value = None)
    use_bias (bool, optional):  (Default value = False)</p>

          <details class="quote">
            <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">trunk_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">branch_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decoder_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pre_network</span><span class="p">:</span> <span class="n">NetworkTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
    <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rescale_factors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">residual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">multiply_by_trunk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_bias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flexible DeepONet uses a subnetwork called &#39;pre-network&#39;, which</span>
<span class="sd">                plays the role of rescaling the trunk input according to the branch input.</span>
<span class="sd">    It is an attempt of reducing the training bias related to the different</span>
<span class="sd">                orders of magnitude contained in the dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        trunk_network (NetworkTemplate, optional): Subnetwork for processing the coordinates inputs. (Default value = None)</span>
<span class="sd">        branch_network (NetworkTemplate, optional): Subnetwork for processing the forcing/conditioning inputs. (Default value = None)</span>
<span class="sd">        decoder_network (NetworkTemplate, optional): Subnetwork for converting the embedding to the output (optional). (Default value = None)</span>
<span class="sd">        pre_network (NetworkTemplate, optional): Subnework used to predict rescaling parameters for the trunk input</span>
<span class="sd">    accordingly the branch input. (Default value = None)</span>
<span class="sd">        var_dim (int, optional): Number of output variables. (Default value = 1)</span>
<span class="sd">        devices (Union[str, list], optional): Devices in which the model will be executed. (Default value = &quot;cpu&quot;)</span>
<span class="sd">        product_type (str, optional): Type of product to execute in the embedding space. (Default value = None)</span>
<span class="sd">        rescale_factors (np.ndarray, optional): Values used for rescaling the network outputs for a given order of magnitude. (Default value = None)</span>
<span class="sd">        residual (bool, optional):  (Default value = False)</span>
<span class="sd">        multiply_by_trunk (bool, optional):  (Default value = False)</span>
<span class="sd">        model_id (str, optional): Name for the model (Default value = None)</span>
<span class="sd">        use_bias (bool, optional):  (Default value = False)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Guaranteeing the compatibility between the pre and the branch and trunk networks</span>
    <span class="n">t_is</span> <span class="o">=</span> <span class="n">trunk_network</span><span class="o">.</span><span class="n">input_size</span>
    <span class="n">p_is</span> <span class="o">=</span> <span class="n">pre_network</span><span class="o">.</span><span class="n">input_size</span>
    <span class="n">p_os</span> <span class="o">=</span> <span class="n">pre_network</span><span class="o">.</span><span class="n">output_size</span>
    <span class="n">b_is</span> <span class="o">=</span> <span class="n">branch_network</span><span class="o">.</span><span class="n">input_size</span>

    <span class="k">assert</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t_is</span> <span class="o">==</span> <span class="n">p_os</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b_is</span> <span class="o">==</span> <span class="n">p_is</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">&quot;The input of branch and pre networks must have the same dimension&quot;</span>
        <span class="s2">&quot; and the output of pre and the input of trunks, too, but got&quot;</span>
        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="p">(</span><span class="n">b_is</span><span class="p">,</span><span class="w"> </span><span class="n">p_is</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="p">(</span><span class="n">t_is</span><span class="p">,</span><span class="w"> </span><span class="n">p_os</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">t_is</span> <span class="o">=</span> <span class="n">t_is</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">FlexibleDeepONet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">trunk_network</span><span class="o">=</span><span class="n">trunk_network</span><span class="p">,</span>
        <span class="n">branch_network</span><span class="o">=</span><span class="n">branch_network</span><span class="p">,</span>
        <span class="n">decoder_network</span><span class="o">=</span><span class="n">decoder_network</span><span class="p">,</span>
        <span class="n">var_dim</span><span class="o">=</span><span class="n">var_dim</span><span class="p">,</span>
        <span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span>
        <span class="n">product_type</span><span class="o">=</span><span class="n">product_type</span><span class="p">,</span>
        <span class="n">rescale_factors</span><span class="o">=</span><span class="n">rescale_factors</span><span class="p">,</span>
        <span class="n">residual</span><span class="o">=</span><span class="n">residual</span><span class="p">,</span>
        <span class="n">multiply_by_trunk</span><span class="o">=</span><span class="n">multiply_by_trunk</span><span class="p">,</span>
        <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
        <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pre_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wrap</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">pre_network</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">forward_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_flexible</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_network</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;pre&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="simulai.models.FlexibleDeepONet.eval_subnetwork" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">eval_subnetwork</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trunk_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">branch_data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#simulai.models.FlexibleDeepONet.eval_subnetwork" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
  
      <p>It evaluates the output of FlexibleDeepONet subnetworks.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the subnetwork. (Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>trunk_data</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>branch_data</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>(Default value = None)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.ndarray: The evaluation performed by the subnetwork.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>simulai/models/_pytorch_models/_deeponet.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@guarantee_device</span>
<span class="k">def</span> <span class="nf">eval_subnetwork</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trunk_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">branch_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;It evaluates the output of FlexibleDeepONet subnetworks.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str, optional): Name of the subnetwork. (Default value = None)</span>
<span class="sd">        trunk_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>
<span class="sd">        branch_data (Union[np.ndarray, torch.Tensor], optional):  (Default value = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The evaluation performed by the subnetwork.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subnetworks_names</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;The name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a subnetwork of </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">.&quot;</span>

    <span class="c1"># Pre and branch network has the same input</span>
    <span class="n">pre_data</span> <span class="o">=</span> <span class="n">branch_data</span>

    <span class="n">network_instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_network&quot;</span><span class="p">)</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_data&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">network_instance</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div></p>
    </article>
</section>
<!-- endblock -->
            </main>

            
                    <!-- block preview -->
        <div class="row row-cols-md-3 text-center pt-md-3" id="component-preview">
            <div class="col themed-grid-col">
                <a rel="prev" href="../simulai_models_transformer/" class="nav-link">
                    <i class="fa fa-arrow-left"></i> Previous
                </a>
            </div>
            <div class="col themed-grid-col"></div>
            <div class="col themed-grid-col">
                <a rel="next" href="../simulai_models_autoencoder/" class="nav-link">
                    Next <i class="fa fa-arrow-right"></i>
                </a>
            </div>
        </div>
<!-- endblock -->
            

            
                    <!-- block footer -->
<footer class="pt-4 my-md-5 pt-md-5 border-top" id="component-footer">
    <div class="row">
        <div class="col-12 col-md">
                <!-- block copyright -->

    <small class="d-block mb-3">
        Made with
        <a href="https://github.com/FernandoCelmer/mkdocs-simple-blog" target="_blank" rel="noopener">
            Simple Blog for MkDocs
        </a>
    </small>

<!-- endblock -->
        </div>
    </div>
</footer>
<!-- endblock -->
            
        </div>

            <script>var base_url = '../..';</script>
            <script src="../../assets/js/jquery-3.3.1.slim.min.js""></script>
            <script src="../../assets/js/bootstrap.bundle.min.js""></script>
            <script src="../../assets/js/main.min.js""></script>
                <script src="../../search/main.js" defer></script>

    </body>

</html>